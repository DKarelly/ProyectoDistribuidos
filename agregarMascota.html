<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agregar Mascota - Huella Feliz</title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="files/casitaicon.png">
    <link rel="shortcut icon" type="image/png" href="files/casitaicon.png">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Iconos -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="CSS/estilos.css">
    <style>
        .upload-area {
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: #dc3545;
            background-color: #f8f9fa;
        }

        .upload-area.dragover {
            border-color: #dc3545;
            background-color: #fff5f5;
        }

        .image-preview {
            max-width: 200px;
            max-height: 200px;
            border-radius: 10px;
            margin-top: 1rem;
        }

        /* Espaciado con el footer solo en esta p치gina */
        .page-spacer {
            margin-bottom: 140px;
        }

        /* Ocultar acceso r치pido al dashboard en esta p치gina */
        #boton {
            display: none !important;
        }
    </style>
</head>

<body>
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold text-danger" href="HUELLA FELIZ.html">
                <img src="files/iconomain.jpg" alt="Huella Feliz" width="32" height="32" class="me-2 d-inline-block">
                HUELLA FELIZ
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="adopciones.html">Adopciones</a></li>
                    <li class="nav-item"><a class="nav-link" href="donaciones.html">Donaciones</a></li>
                    <li class="nav-item"><a class="nav-link" href="blog.html">Blog</a></li>
                    <li class="nav-item"><a class="nav-link" href="reportar.html">Reportar</a></li>
                    <li class="nav-item"><a class="nav-link" href="acercaDe.html">Acerca de</a></li>

                    <li class="nav-item"><a class="nav-link bi bi-speedometer2" id="boton" href="dashboard.html">
                    <li class="nav-item"><a class="nav-link" id="iniciarSesion" href="iniciarSesion.html">Iniciar
                            Sesion</a></li>
                    <li class="nav-item"><a class="nav-link btn-pink-custom ms-2" href="adopciones.html">Adopta aqui</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- CONTENIDO PRINCIPAL -->
    <div class="container page-spacer" style="margin-top: 100px;">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card shadow">
                    <div class="card-header bg-pink text-white d-flex align-items-center gap-2" style="cursor:pointer"
                        onclick="toggleFormCard()">
                        <i class="bi bi-dash-circle" id="formIcon"></i>
                        <h4 class="mb-0">Agregar Nueva Mascota</h4>
                    </div>
                    <div class="card-body p-4" id="formCardBody">
                        <form id="formAgregarMascota" enctype="multipart/form-data">
                            <div class="row g-3">
                                <!-- Informaci칩n b치sica -->
                                <div class="col-12">
                                    <h5 class="text-pink mb-3">Informaci칩n B치sica</h5>
                                </div>

                                <div class="col-md-6">
                                    <label for="nombreAnimal" class="form-label">Nombre del Animal *</label>
                                    <input type="text" class="form-control" id="nombreAnimal" name="nombreAnimal"
                                        required>
                                </div>

                                <div class="col-md-6">
                                    <label for="especie" class="form-label">Especie *</label>
                                    <select class="form-select" id="especie" name="especie" required>
                                        <option value="">Seleccionar especie</option>
                                        <option value="Perro">Perro</option>
                                        <option value="Gato">Gato</option>
                                    </select>
                                </div>

                                <div class="col-md-6">
                                    <label for="raza" class="form-label">Raza *</label>
                                    <select class="form-select" id="raza" name="raza" required disabled>
                                        <option value="">Primero selecciona una especie</option>
                                    </select>
                                </div>

                                <div class="col-md-6">
                                    <label for="edadMeses" class="form-label">Edad (meses) *</label>
                                    <input type="number" class="form-control" id="edadMeses" name="edadMeses" min="0"
                                        max="240" required>
                                </div>

                                <div class="col-md-6">
                                    <label for="genero" class="form-label">G칠nero *</label>
                                    <select class="form-select" id="genero" name="genero" required>
                                        <option value="">Seleccionar g칠nero</option>
                                        <option value="M">Macho</option>
                                        <option value="H">Hembra</option>
                                    </select>
                                </div>

                                <div class="col-md-6">
                                    <label for="peso" class="form-label">Peso (kg)</label>
                                    <input type="number" class="form-control" id="peso" name="peso" min="0.1"
                                        step="0.1">
                                </div>

                                <div class="col-md-6">
                                    <label for="pelaje" class="form-label">Tipo de Pelaje</label>
                                    <select class="form-select" id="pelaje" name="pelaje">
                                        <option value="">Seleccionar pelaje</option>
                                        <option value="Corto">Corto</option>
                                        <option value="Medio">Medio</option>
                                        <option value="Largo">Largo</option>
                                    </select>
                                </div>

                                <div class="col-md-6">
                                    <label for="tama침o" class="form-label">Tama침o</label>
                                    <select class="form-select" id="tama침o" name="tama침o">
                                        <option value="">Seleccionar tama침o</option>
                                        <option value="Peque침o">Peque침o</option>
                                        <option value="Mediano">Mediano</option>
                                        <option value="Grande">Grande</option>
                                    </select>
                                </div>

                                <!-- Foto del Animal (igual que modal admin) -->
                                <h5 class="text-pink mb-3 mt-4">Foto del Animal *</h5>
                                <div class="col-12">
                                    <div class="upload-area"
                                        style="border: 2px dashed #ff5c8d; border-radius: 10px; padding: 30px; text-align: center; background-color: #f8f9fa;">
                                        <i class="bi bi-cloud-upload" style="font-size: 3rem; color: #ff5c8d;"></i>
                                        <p class="mt-2 mb-1">Arrastra y suelta im치genes o videos aqu칤 o haz clic para
                                            seleccionar</p>
                                        <p class="text-muted small">Formatos: JPG, PNG, GIF, MP4, AVI, MOV (m치x. 10MB
                                            cada uno)
                                        </p>
                                        <p class="text-muted small"><strong>Puedes seleccionar m칰ltiples
                                                archivos</strong></p>
                                        <input type="file" class="form-control d-none" id="fotoAgregarAnimal"
                                            accept="image/*,video/*" multiple>
                                        <button type="button" class="btn btn-outline-pink mt-2"
                                            onclick="document.getElementById('fotoAgregarAnimal').click()">
                                            <i class="bi bi-camera me-2"></i>Seleccionar Archivo
                                        </button>
                                    </div>
                                    <div class="mt-3" id="fotoPreviewContainer" style="display: none;">
                                        <div class="text-center">
                                            <p id="previewType" class="mt-2 text-muted small"></p>
                                            <div id="previewGrid" class="row g-2 mt-2">
                                                <!-- Las previsualizaciones se insertar치n aqu칤 din치micamente -->
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Informaci칩n adicional -->
                                <div class="col-12">
                                    <h5 class="text-pink mb-3 mt-4">Informaci칩n Adicional</h5>
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label">Tipo de Enfermedad (opcional)</label>
                                    <select class="form-select" id="tipoEnfermedadRegistrarAnimal">
                                        <option value="">Seleccionar tipo</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Enfermedad (opcional)</label>
                                    <select class="form-select" id="enfermedadRegistrarAnimal" disabled>
                                        <option value="">Primero selecciona un tipo</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Gravedad (opcional)</label>
                                    <select class="form-select" id="gravedadRegistrarAnimal">
                                        <option value="">Seleccionar gravedad</option>
                                        <option value="Leve">Leve</option>
                                        <option value="Moderada">Moderada</option>
                                        <option value="Grave">Grave</option>
                                        <option value="Cr칤tica">Cr칤tica</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Medicinas (opcional)</label>
                                    <input type="text" class="form-control" id="medicinasRegistrarAnimal"
                                        placeholder="Ej: Amoxicilina, Ivermectina">
                                </div>
                                <div class="col-12">
                                    <label for="descripcion" class="form-label">Descripci칩n / Historial
                                        (opcional)</label>
                                    <textarea class="form-control" id="descripcion" name="descripcion" rows="4"
                                        placeholder="Cu칠ntanos sobre el animal, su personalidad, historial m칠dico, etc."></textarea>
                                </div>
                            </div>

                            <div class="row mt-4">
                                <div class="col-12 text-center">
                                    <button type="button" class="btn btn-secondary me-2"
                                        onclick="window.location.href='adopciones.html'">
                                        <i class="bi bi-arrow-left me-1"></i>Cancelar
                                    </button>
                                    <button type="submit" class="btn btn-pink">
                                        <i class="bi bi-plus-circle me-1"></i>Agregar Mascota
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>


            </div>
        </div>
    </div>



    <footer class="py-5 bg-pink text-white">
        <div class="container">
            <div class="row">
                <!-- Navegacion -->
                <div class="col-6 col-md-3 mb-4">
                    <h5 class="fw-bold">Navegacion</h5>
                    <ul class="list-unstyled">
                        <li><a href="HUELLA FELIZ.html" class="text-white text-decoration-none">Inicio</a></li>
                        <li><a href="donaciones.html" class="text-white text-decoration-none">Donaciones</a></li>
                        <li><a href="adopciones.html" class="text-white text-decoration-none">Adopciones</a></li>
                        <li><a href="blog.html" class="text-white text-decoration-none">Blog</a></li>
                        <li><a href="reportar.html" class="text-white text-decoration-none">Reportar</a></li>
                        <li><a href="acercaDe.html" class="text-white text-decoration-none">Acerca de</a></li>
                    </ul>
                </div>

                <!-- Redes sociales -->
                <div class="col-6 col-md-3 mb-4">
                    <h5 class="fw-bold">Redes sociales</h5>
                    <ul class="list-unstyled">
                        <li><a href="https://www.facebook.com/PatitasSolidariasChiclayo" target="_blank"
                                class="text-white text-decoration-none"><i class="bi bi-facebook me-2"></i>Facebook</a>
                        </li>
                        <li><a href="https://www.instagram.com/refugioanimal.chiclayo/" target="_blank"
                                class="text-white text-decoration-none"><i
                                    class="bi bi-instagram me-2"></i>Instagram</a>
                        </li>
                    </ul>
                </div>

                <!-- About -->
                <div class="col-6 col-md-3 mb-4">
                    <h5 class="fw-bold">Acerca de</h5>
                    <ul class="list-unstyled">
                        <li><a href="#" class="text-white text-decoration-none" data-bs-toggle="modal"
                                data-bs-target="#modalPrivacidad">Pol칤tica de Privacidad</a></li>
                        <li><a href="#" class="text-white text-decoration-none" data-bs-toggle="modal"
                                data-bs-target="#modalTerminos">T칠rminos y Condiciones</a></li>
                    </ul>
                </div>

                <!-- Info -->
                <div class="col-12 col-md-3 mb-4">
                    <h5 class="fw-bold">HUELLA FELIZ</h5>
                    <p class="small">
                        Somos una organizacion dedicada al rescate, adopcion y proteccion de animales en situacion de
                        abandono.
                        Unete como voluntario o apoyanos con tus donaciones.
                    </p>
                </div>
            </div>

            <!-- Linea inferior -->
            <div class="text-center border-top border-light pt-3 mt-3">
                <p class="mb-0 small">&copy; 2025 Huella Feliz - Todos los derechos reservados</p>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="JS/codigo.js"></script>
    <script>
        // Para esta p치gina p칰blica no restringimos por rol; solo actualizamos la UI si est치 logueado
        document.addEventListener('DOMContentLoaded', function () {
            updateAuthUI();
        });
    </script>
    <script>
        // Manejo de m칰ltiples archivos (igual que modal admin)
        let archivosSeleccionados = [];

        // Cargar combos de ESPECIE y RAZA
        document.addEventListener('DOMContentLoaded', function () {
            const especieSelect = document.getElementById('especie');
            const razaSelect = document.getElementById('raza');
            (async () => {
                try {
                    const resp = await fetch('/api/especieRaza/especies');
                    const data = await resp.json();
                    if (resp.ok && data.data) {
                        especieSelect.innerHTML = '<option value="">Seleccionar especie</option>';
                        data.data.forEach(e => {
                            const opt = document.createElement('option');
                            opt.value = e.especieanimal || e.especieAnimal;
                            opt.textContent = e.especieanimal || e.especieAnimal;
                            opt.dataset.id = e.idespecie || e.idEspecie;
                            especieSelect.appendChild(opt);
                        });
                    }
                } catch (_) { }
            })();

            especieSelect.addEventListener('change', async function () {
                const selected = this.options[this.selectedIndex];
                const especieId = selected?.dataset?.id;
                razaSelect.innerHTML = '<option value="">Cargando razas...</option>';
                razaSelect.disabled = true;
                if (!especieId) {
                    razaSelect.innerHTML = '<option value="">Primero selecciona una especie</option>';
                    return;
                }
                try {
                    const resp = await fetch(`/api/especieRaza/razas?especie=${encodeURIComponent(especieId)}`);
                    const data = await resp.json();
                    if (resp.ok && data.data) {
                        razaSelect.innerHTML = '<option value="">Seleccionar raza</option>';
                        data.data.forEach(r => {
                            const opt = document.createElement('option');
                            opt.value = r.razaanimal || r.razaAnimal;
                            opt.textContent = r.razaanimal || r.razaAnimal;
                            razaSelect.appendChild(opt);
                        });
                        razaSelect.disabled = false;
                    } else {
                        razaSelect.innerHTML = '<option value="">No se encontraron razas</option>';
                    }
                } catch (_) {
                    razaSelect.innerHTML = '<option value="">Error cargando razas</option>';
                }
            });

            // Sistema de m칰ltiples archivos (igual que admin)
            const fotoAgregarAnimalInput = document.getElementById('fotoAgregarAnimal');
            const previewType = document.getElementById('previewType');
            const fotoPreviewContainer = document.getElementById('fotoPreviewContainer');
            const previewGrid = document.getElementById('previewGrid');
            const uploadArea = fotoAgregarAnimalInput?.closest('.upload-area');

            if (fotoAgregarAnimalInput && previewType && fotoPreviewContainer && previewGrid) {
                // Cambio de archivo
                fotoAgregarAnimalInput.addEventListener('change', function (event) {
                    const nuevosArchivos = Array.from(event.target.files);
                    archivosSeleccionados = archivosSeleccionados.concat(nuevosArchivos);
                    event.target.value = '';
                    actualizarPrevisualizacion();
                });

                // Arrastrar y soltar
                if (uploadArea) {
                    uploadArea.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        uploadArea.style.backgroundColor = '#f0f0f0';
                    });

                    uploadArea.addEventListener('dragleave', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        uploadArea.style.backgroundColor = '#f8f9fa';
                    });

                    uploadArea.addEventListener('drop', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        uploadArea.style.backgroundColor = '#f8f9fa';
                        const droppedFiles = Array.from(e.dataTransfer.files);
                        archivosSeleccionados = archivosSeleccionados.concat(droppedFiles);
                        actualizarPrevisualizacion();
                    });
                }
            }

            function actualizarPrevisualizacion() {
                if (archivosSeleccionados.length === 0) {
                    fotoPreviewContainer.style.display = 'none';
                    return;
                }

                fotoPreviewContainer.style.display = 'block';
                previewGrid.innerHTML = '';

                let imagenesCount = 0;
                let videosCount = 0;
                let archivosInfo = [];

                archivosSeleccionados.forEach((file, index) => {
                    if (file.type.startsWith('image/')) {
                        imagenesCount++;
                        archivosInfo.push(`游닝 ${file.name}`);
                    } else if (file.type.startsWith('video/')) {
                        videosCount++;
                        archivosInfo.push(`游꿘 ${file.name}`);
                    }
                });

                previewType.innerHTML = `
                    <strong>Archivos seleccionados (${archivosSeleccionados.length}):</strong><br>
                    ${archivosInfo.join('<br>')}
                `;

                archivosSeleccionados.forEach((file, index) => {
                    const col = document.createElement('div');
                    col.className = 'col-md-3 col-sm-4 col-6';

                    const card = document.createElement('div');
                    card.className = 'card mb-2';
                    card.style.position = 'relative';

                    const cardBody = document.createElement('div');
                    cardBody.className = 'card-body p-2 text-center';

                    if (file.type.startsWith('image/')) {
                        const img = document.createElement('img');
                        img.className = 'img-thumbnail';
                        img.style.maxWidth = '100px';
                        img.style.maxHeight = '100px';
                        img.style.objectFit = 'cover';

                        const reader = new FileReader();
                        reader.onload = function (e) {
                            img.src = e.target.result;
                        };
                        reader.readAsDataURL(file);
                        cardBody.appendChild(img);
                    } else if (file.type.startsWith('video/')) {
                        const video = document.createElement('video');
                        video.className = 'img-thumbnail';
                        video.style.maxWidth = '100px';
                        video.style.maxHeight = '100px';
                        video.style.objectFit = 'cover';
                        video.controls = true;
                        video.muted = true;

                        const reader = new FileReader();
                        reader.onload = function (e) {
                            video.src = e.target.result;
                        };
                        reader.readAsDataURL(file);
                        cardBody.appendChild(video);
                    }

                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'btn btn-sm btn-danger position-absolute';
                    deleteBtn.style.top = '5px';
                    deleteBtn.style.right = '5px';
                    deleteBtn.style.padding = '2px 6px';
                    deleteBtn.innerHTML = '칑';
                    deleteBtn.onclick = function () {
                        archivosSeleccionados.splice(index, 1);
                        actualizarPrevisualizacion();
                    };

                    const fileName = document.createElement('small');
                    fileName.className = 'd-block text-muted mt-1';
                    fileName.textContent = file.name.length > 15 ? file.name.substring(0, 15) + '...' : file.name;
                    fileName.title = file.name;

                    cardBody.appendChild(fileName);
                    card.appendChild(cardBody);
                    card.appendChild(deleteBtn);
                    col.appendChild(card);
                    previewGrid.appendChild(col);
                });
            }

            // Manejo del formulario
            document.getElementById('formAgregarMascota').addEventListener('submit', function (e) {
                e.preventDefault();
                agregarMascota();
            });
        });

        // Funci칩n para agregar mascota
        async function agregarMascota() {
            const form = document.getElementById('formAgregarMascota');
            const formData = new FormData();

            // Campos requeridos
            formData.append('nombreAnimal', document.getElementById('nombreAnimal').value.trim());
            formData.append('especie', document.getElementById('especie').value);
            formData.append('raza', document.getElementById('raza').value.trim());
            formData.append('edadMeses', document.getElementById('edadMeses').value);
            formData.append('genero', document.getElementById('genero').value);

            // Opcionales
            const peso = document.getElementById('peso').value;
            const pelaje = document.getElementById('pelaje').value;
            const tama침o = document.getElementById('tama침o').value;
            const descripcion = document.getElementById('descripcion').value;
            const tipoEnf = document.getElementById('tipoEnfermedadRegistrarAnimal').value;
            const enfermedadId = document.getElementById('enfermedadRegistrarAnimal').value;
            const gravedad = document.getElementById('gravedadRegistrarAnimal').value;
            const medicinas = document.getElementById('medicinasRegistrarAnimal').value;

            if (peso) formData.append('peso', peso);
            if (pelaje) formData.append('pelaje', pelaje);
            if (tama침o) formData.append('tama침o', tama침o);
            if (descripcion) formData.append('descripcion', descripcion);
            if (enfermedadId) formData.append('enfermedadId', enfermedadId);
            if (gravedad) formData.append('gravedad', gravedad);
            if (medicinas) formData.append('medicinas', medicinas);

            // Obtener bot칩n de submit
            const submitBtn = form.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;

            // Archivos: separar im치genes y videos del array archivosSeleccionados
            if (archivosSeleccionados.length === 0) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Debes seleccionar al menos una imagen o video'
                });
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
                return;
            }

            archivosSeleccionados.forEach(file => {
                if (file.type.startsWith('image/')) {
                    formData.append('imagenAnimal', file);
                } else if (file.type.startsWith('video/')) {
                    formData.append('videoAnimal', file);
                }
            });

            // Mostrar loading
            submitBtn.innerHTML = '<i class="bi bi-hourglass-split me-1"></i>Agregando...';
            submitBtn.disabled = true;

            try {
                // Enviar a solicitud si no es admin, de lo contrario alta directa
                const cur = JSON.parse(localStorage.getItem('currentUser') || 'null');
                const isAdmin = cur && cur.idRol === 1;
                const endpoint = isAdmin ? '/api/animals/agregar' : '/api/animals/solicitar';
                const headers = {};
                const tokSubmit = localStorage.getItem('authToken');
                if (tokSubmit) headers['Authorization'] = `Bearer ${tokSubmit}`;

                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers,
                    body: formData
                });

                const data = await response.json();

                if (response.ok) {
                    const successMsg = isAdmin ? '춰Mascota agregada exitosamente!' : '춰Solicitud enviada! Un administrador revisar치 tu petici칩n.';
                    showMessage(successMsg, 'success');
                    // Limpiar archivos y vista previa
                    archivosSeleccionados = [];
                    const fotoPreviewContainerClean = document.getElementById('fotoPreviewContainer');
                    const previewGridClean = document.getElementById('previewGrid');
                    if (fotoPreviewContainerClean) fotoPreviewContainerClean.style.display = 'none';
                    if (previewGridClean) previewGridClean.innerHTML = '';
                    // Resetear formulario
                    document.getElementById('formAgregarMascota').reset();

                    if (isAdmin) {
                        setTimeout(() => { window.location.href = 'adopciones.html'; }, 2000);
                    }
                } else {
                    if (response.status === 401 || response.status === 403) {
                        localStorage.removeItem('authToken');
                        localStorage.removeItem('currentUser');
                        showMessage('Tu sesi칩n ha expirado. Inicia sesi칩n nuevamente.', 'warning');
                        setTimeout(() => { window.location.href = 'iniciarSesion.html'; }, 1500);
                    } else {
                        showMessage(data.message || 'Error al agregar la mascota', 'danger');
                    }
                }
            } catch (error) {
                showMessage('Error de conexi칩n. Intenta nuevamente.', 'danger');
            } finally {
                // Restaurar bot칩n
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        // Cargar listas de tipos de enfermedad y enfermedades (opcional)
        document.addEventListener('DOMContentLoaded', async function () {
            try {
                // Tipos de enfermedad
                const tiposResp = await fetch('/api/animals/tipos-enfermedad');
                const tiposData = await tiposResp.json();
                const tipoSelect = document.getElementById('tipoEnfermedadRegistrarAnimal');
                if (tiposResp.ok && tiposData.data) {
                    tiposData.data.forEach(t => {
                        const opt = document.createElement('option');
                        opt.value = t.idtipoenfermedad;
                        opt.textContent = t.tipoenfermedad;
                        tipoSelect.appendChild(opt);
                    });
                }

                // Al cambiar tipo cargar enfermedades
                tipoSelect.addEventListener('change', async function () {
                    const enfSelect = document.getElementById('enfermedadRegistrarAnimal');
                    enfSelect.innerHTML = '<option value="">Seleccionar enfermedad</option>';
                    enfSelect.disabled = true;
                    const tipoId = this.value;
                    if (!tipoId) return;
                    const enfResp = await fetch(`/api/animals/enfermedades-por-tipo/${tipoId}`);
                    const enfData = await enfResp.json();
                    if (enfResp.ok && enfData.data) {
                        enfData.data.forEach(e => {
                            const opt = document.createElement('option');
                            opt.value = e.idenfermedad;
                            opt.textContent = e.nombenfermedad;
                            enfSelect.appendChild(opt);
                        });
                        enfSelect.disabled = false;
                    }
                });
            } catch (_) { /* silencioso */ }
        });

        // (Se elimin칩 la secci칩n de Mis Solicitudes a pedido del usuario)
        function toggleFormCard() {
            const body = document.getElementById('formCardBody');
            const icon = document.getElementById('formIcon');
            const visible = body.style.display !== 'none';
            body.style.display = visible ? 'none' : 'block';
            icon.className = visible ? 'bi bi-plus-circle' : 'bi bi-dash-circle';
        }
        // (Se removi칩 la secci칩n Mis Solicitudes a solicitud del usuario)
    </script>
</body>

</html>